---
title: "Covid-19 Cases and Vaccination Rates"
author: "Kongtao Chen, Eric Shin, Laith Darwish"
date: "2/16/2022"
output: 
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('tidyverse') ; library('modeldata') ; library('ggplot2');
library('jsonlite') ; library('rgdal') ; library('sf'); library('extrafont') ; library('ggspatial');library('ggplot2'); library('here')
library('patchwork') ; library('scico') ; library('dplyr'); library('flexdashboard');
library('maps'); library('albersusa'); library('plotly'); library('plyr')
#in order to use the albersusa, you need to install the "remotes" package frist, and run this line of code remotes::install_github("hrbrmstr/albersusa")

options(digits = 3)
set.seed(1234)
theme_set(theme_minimal())
```

# Introduction

This R Markdown document demonstrates our abilities to use models for data analysis using a data set collected on Covid-19 vaccination rates, cases, and some data related to them.

## Covid-19 Vaccination Rates and Cases{.tabset}

In this report, we examine the relationship between vaccine coverage and confirmed cases in US states. And further compare the vaccine coverage rate and the education level or average income of each state to try to figure out the reasons that may affect the vaccine coverage rate.
```{r load data}
vac_base <- read.csv("Vaccination_Base.csv", row.names=NULL)
#vac_rates <- vac_base$Admin_Per_100K
#vac_rates <- cbind(vac_base$Location, vac_base$Admin_Per_100K)
rate_cases <- vac_base %>% 
  select(State_Abbreviations, Location, Admin_Per_100K, Per_Cases) %>%
  arrange(desc(Admin_Per_100K))
rate_education <- vac_base %>% 
  select(State_Abbreviations, Location, Admin_Per_100K, Percent_High_School_Or_Higher, Percent_Bachel_Or_Higher) %>%
  arrange(desc(Percent_High_School_Or_Higher), desc(Percent_Bachel_Or_Higher))
rate_income <- vac_base %>% 
  select(State_Abbreviations, Location, Admin_Per_100K, Household_Income) %>%
  arrange(desc(Household_Income))
```

### U.S. Covid-19 Vaccination Rates of Each States

In this map, we shows the Covid-19 vaccination rates of each states, and weight the color by using the Admin_Per_100K value. Amdin_Per_100K value shows the total number of doses administered per 100,000 census population based on the jurisdiction where recipient lives.

```{r ratemap, echo = FALSE}
usa <- st_read("cb_2018_us_state_20m/cb_2018_us_state_20m.shp")
usa_48 <- usa %>%
    filter(!(NAME %in% c("Alaska", "District of Columbia", "Hawaii", "Puerto Rico")))
usa_fb <- usa_sf() %>%
  left_join(rate_cases, by = c("name" = "Location"))

g <- ggplot(data = usa_fb) +
  geom_sf(aes(fill = Admin_Per_100K)) + scale_fill_viridis_c(option = "A", direction = -1)

ggplotly(g)
```

### U.S. Covid-19 Cases Rates of Each States

In this map, we shows the Covid-19 cases rates of each states, and weight the color by using the Per_Cases value. Per_Cases value shows Shows the state's confirmed cases as a percentage of the state's total population.

```{r casemap, echo = FALSE}
g <- ggplot(data = usa_fb) +
  geom_sf(aes(fill = Per_Cases)) + scale_fill_viridis_c(option = "A", direction = -1)

ggplotly(g)
```

### Vaccination Rates vs Covid-19 Cases Rates

In this scatter plot, we shows the relationship between the vaccination rates and cases rates of each states, and weight the color by the the Admin_Per_100K. We can see from the graph that the vaccination rates and the cases rates of each states are likely to be in a linear relationship, which means for most of the states, states with a smaller proportion of confirmed cases of the population generally have a higher proportion of vaccination rates.

```{r scatterplot, echo = FALSE}
g <- ggplot(data = rate_cases, mapping = aes(x = Admin_Per_100K, y = Per_Cases))  + 
  geom_point(mapping = aes(color = Admin_Per_100K)) +
  geom_smooth() +
ggtitle("Vaccination rates vs Covid-19 Cases by State (Per 100K)") +
 xlab("Doses Administered Per 100K") +
  ylab("Total Covid-19 Cases") +
ggtitle("Vaccination rates vs Covid-19 Cases by State (Per 100K)")

ggplotly(g)
```

### The Highest 5 and the lowest 5 Vaccination Rates States

In these two bar graphs, we shows the 5 states who have the highest vaccination rates, and 5 states who have the lowest vaccination rates.From these two graphs, we can see that the disparity in vaccination rates from state to state is still very large. Which means we need to make more efforts in states with low vaccination rates to increase vaccination rates across the country so that we can better respond to the outbreak.

```{r bar_graph_vac, echo = FALSE}

g <- ggplot(data = head(rate_cases,5))
g <- g + geom_col(aes(x = Admin_Per_100K, y = reorder(State_Abbreviations, Admin_Per_100K), fill = State_Abbreviations )) +
  ggtitle("5 Highest States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none")

ggplotly(g)

g <- ggplot(data = tail(rate_cases,5))
g <- g + geom_col(aes(x = Admin_Per_100K, y = reorder(State_Abbreviations, Admin_Per_100K), fill = State_Abbreviations )) +
  ggtitle("5 Lowest States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none") +
  scale_x_continuous(limits = c(0,220000)) 

ggplotly(g)

```

## Covid-19 Vaccination Rates and Educational Level{.tabset}
Some introduction

### Educational Level of Each U.S. State
This map displays the rate of education by state.
```{r educationmap, echo = FALSE}
usa_fb <- usa_sf() %>%
  left_join(rate_education, by = c("name" = "Location"))
g <- ggplot(data = usa_fb) +
  geom_sf(aes(fill = Percent_High_School_Or_Higher)) +
scale_fill_viridis_c(option = "A", direction = -1)

ggplotly(g)

g <- ggplot(data = usa_fb) +
  geom_sf(aes(fill = Percent_Bachel_Or_Higher)) +
scale_fill_viridis_c(option = "A", direction = -1)

ggplotly(g)
```

### Vaccination Rates vs Educational Level
This scatter plot displays the total vaccination rate compared to rate of people who have a high school education or higher.
```{r scatterplot_education, echo=FALSE}
g <- ggplot(data = rate_education, mapping = aes(x = Admin_Per_100K, y = Percent_High_School_Or_Higher)) + 
  geom_point(mapping = aes(color = Admin_Per_100K)) +
  geom_smooth() +
ggtitle("Vaccination Rates vs Educational Level by State (Per 100K)") +
 xlab("Doses Administered Per 100K") +
  ylab("Percentage of High School Degree or Higher") +
ggtitle("Vaccination Rates vs Educational Level by State (Per 100K)")

ggplotly(g)

```

### The Highest 5 and the lowest 5 Educational Level States
These bar charts represents the 5 highest and lowest percentages of high school graduation by state.
```{r bar_graph_education, echo = FALSE}
g <- ggplot(data = head(rate_education,5)) 
g <- g + geom_col(aes(x = Percent_High_School_Or_Higher, y = reorder(State_Abbreviations, Percent_High_School_Or_Higher), fill = State_Abbreviations )) +
  ggtitle("5 Highest Educational Level States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none")+
  scale_x_continuous(limits = c(0,100)) 

ggplotly(g)

g <- ggplot(data = tail(rate_education,5)) 
g <- g + geom_col(aes(x = Percent_High_School_Or_Higher, y = reorder(State_Abbreviations, Percent_High_School_Or_Higher), fill = State_Abbreviations )) +
  ggtitle("5 Lowest Educational Level States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none")+
  scale_x_continuous(limits = c(0,100)) 

ggplotly(g)
```

## Household Income of Each U.S. State{.tabset}

In this section, we analyze how the median household income of each U.S. State has an impact on the vaccination rates of each U.S. State.

### Household Income of Each U.S. State

This data map shows the median household income of each U.S. State.

```{r incomemap, echo = FALSE}
usa_fb <- usa_sf() %>%
  left_join(rate_income, by = c("name" = "Location"))
g <- ggplot(data = usa_fb) +
  geom_sf(aes(fill = Household_Income)) +
scale_fill_viridis_c(option = "A", direction = -1)

ggplotly(g)
```

### Vaccination Rates vs Household Income

This scatter plot compares the median household income of each U.S. State with the vaccination rates of each state. The purpose is to show if the household income of a state has an affect on the vaccination rate of a state.

```{r scatterplot_income, echo=FALSE}
g <- ggplot(data = rate_income, mapping = aes(x = Admin_Per_100K, y = Household_Income)) + 
  geom_point(mapping = aes(color = Admin_Per_100K)) +
  geom_smooth() +
ggtitle("Vaccination Rates vs Household Income by State (Per 100K)") +
 xlab("Doses Administered Per 100K") +
  ylab("Household Income") +
ggtitle("Vaccination Rates vs Household Income by State (Per 100K)")

ggplotly(g)
```

### The Highest 5 and the lowest 5 Household Income States

Based on the median household income of each U.S. state, these bar graphs show the 5 highest and 5 lowest household income states.

```{r bar_graph_income, echo = FALSE}
g <- ggplot(data = head(rate_income,5)) 
g <- g+ geom_col(aes(x = Household_Income, y = reorder(State_Abbreviations, Household_Income), fill = State_Abbreviations )) +
  ggtitle("5 Highest Income States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none")+
  scale_x_continuous(limits = c(0,100000)) 

ggplotly(g)

g <- ggplot(data = tail(rate_income,5)) 
g <- g + geom_col(aes(x = Household_Income, y = reorder(State_Abbreviations, Household_Income), fill = State_Abbreviations )) +
  ggtitle("5 Lowest Income States", subtitle = "Data on Each U.S. State") +
  theme(legend.position="none")+
  scale_x_continuous(limits = c(0,100000)) 

ggplotly(g)
```

